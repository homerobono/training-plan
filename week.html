<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/training-plan/favicon.ico">
    <title>Plano de Treino</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: #1a1a1a;
            -webkit-user-select: none;
            user-select: none;
        }

        .container {
            padding: 16px;
        }

        h1, h2 {
            font-weight: 700;
        }

        h1 {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            color: #e74c3c;
        }

        h2 {
            font-size: 1.25rem;
            margin-top: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #f1f1f1;
        }

        h2#resumo-semanal { color: #34495e; }
        h2#forca-costas-biceps { color: #c0392b; }
        h2#forca-peito-ombros { color: #e67e22; }
        h2#forca-pernas { color: #2980b9; }
        h2#mobilidade { color: #8e44ad; }

        .agenda-list {
            margin-bottom: 2.5rem;
            margin-top: 1rem;
        }

        .day-item {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 8px;
            overflow: hidden;
            transition: box-shadow 0.2s, border-color 0.2s;
        }
        
        .day-item.is-today {
            border-color: #1a1a1a; /* Borda preta para o dia de hoje */
            border-width: 2px;
        }
        .day-item.is-today .day-name {
            font-weight: 900;
            color: #1a1a1a;
        }
        
        .day-item.active {
             box-shadow: 0 0 0 2px #3b82f6;
        }
        
        .day-item.has-warning {
            border-color: #f59e0b;
        }
        
        .global-warning {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            text-align: left;
            background-color: #fefce8;
            color: #a16207;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #fef08a;
            font-size: 0.85rem;
            font-weight: 500;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
        }
        .global-warning .warning-icon {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .day-display {
            display: flex;
            align-items: center;
            padding: 12px;
            cursor: pointer;
            background-color: #fff;
        }

        .day-name {
            font-weight: 700;
            font-size: 0.8rem;
            color: #6c757d;
            width: 45px;
        }

        .activity-color-bar {
            width: 4px;
            height: 24px;
            border-radius: 2px;
            margin-right: 12px;
        }
        
        .activity-icon {
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }
        .activity-icon img, .activity-icon svg {
            width: 100%;
            height: 100%;
        }

        .activity-name {
            font-weight: 600;
            font-size: 0.9rem;
            flex-grow: 1;
        }
        
        .edit-icon {
            width: 20px;
            height: 20px;
            stroke: #9ca3af;
        }
        
        .warning-icon {
            width: 20px;
            height: 20px;
            color: #f59e0b;
            margin-left: 8px;
            margin-right: 8px;
        }
        
        .activity-options {
            background-color: #f8f9fa;
            padding: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .option-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .option-btn.selected {
             transform: scale(1.1);
             box-shadow: 0 0 0 2px;
        }

        .option-btn:not(.selected) {
            opacity: 0.6;
        }
        
        .option-costas { border-color: #c0392b; color: #c0392b; }
        .option-costas.selected { background-color: #c0392b; color: white; }

        .option-peito { border-color: #e67e22; color: #e67e22; }
        .option-peito.selected { background-color: #e67e22; color: white; }
        
        .option-pernas { border-color: #2980b9; color: #2980b9; }
        .option-pernas.selected { background-color: #2980b9; color: white; }

        .option-mobilidade { border-color: #8e44ad; color: #8e44ad; }
        .option-mobilidade.selected { background-color: #8e44ad; color: white; }
        
        .option-cardio { border-color: #6c757d; color: #6c757d; }
        .option-cardio.selected { background-color: #6c757d; color: white; }
        
        .option-btn svg, .option-btn img { width: 20px; height: 20px; }

        .content-section { margin-bottom: 1.5rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
        th, td { padding: 10px 8px; text-align: left; font-size: 0.85rem; border-bottom: 1px solid #f1f1f1; }
        thead th { font-size: 0.7rem; text-transform: uppercase; color: white; padding: 8px; }
        tbody tr:last-child td { border-bottom: none; }
        .forca-costas-biceps-section thead th { background-color: #c0392b; }
        .forca-peito-ombros-section thead th { background-color: #e67e22; }
        .forca-pernas-section thead th { background-color: #2980b9; }
        .mobilidade-section thead th { background-color: #8e44ad; }
        .exercise-name { font-weight: 600; font-size: 0.9rem; }
        .exercise-note { display: block; font-size: 0.7rem; font-style: italic; color: #6c757d; margin-top: 4px; }
        .toggle-row { cursor: pointer; }
        .toggle-row:hover { background-color: #f5f5f5; }
        .details-row td { background-color: #f9f9f9; padding: 12px; font-style: italic; font-size: 0.8rem; color: #555; }
        .collapsible-title { cursor: pointer; position: relative; padding-right: 30px; }
        .collapsible-title::after { content: '›'; font-size: 1.8rem; position: absolute; right: 8px; top: 50%; transform: translateY(-50%) rotate(0deg); transition: transform 0.2s; font-weight: 400; }
        .collapsible-title.expanded::after { transform: translateY(-50%) rotate(90deg); }
        .superset-group td:first-child { border-left: 3px solid #dee2e6; padding-left: 15px; background-color: #fafafa; }
        .superset-group td { background-color: #fafafa; }
        .superset-group:last-of-type td { border-bottom: 1px solid #f1f1f1; }
        .hidden { display: none; }
    </style>
</head>

<body>
    <div class="container mx-auto max-w-2xl">
        <h1>PLANO DE TREINO</h1>
        <p class="mb-6 text-center text-sm text-gray-700">Otimizado para força e recuperação. Toque em um dia para alterar a atividade.</p>

        <h2 id="resumo-semanal" class="font-bold">RESUMO SEMANAL</h2>
        <div id="agenda-global-warning" class="hidden"></div>
        <div id="agenda-container" class="agenda-list">
            <!-- Agenda será gerada pelo JS -->
        </div>
        
        <div class="forca-costas-biceps-section content-section">
            <h2 id="forca-costas-biceps" class="collapsible-title">COSTAS E BÍCEPS</h2>
            <table class="collapsible-content hidden">
                <thead><tr><th>Exercício</th><th>S x R - D</th><th>Carga</th></tr></thead>
                <tbody>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Puxada na Barra Fixa</td><td>3-4x(6-8) - 90s</td><td><input type="text" data-exercise-id="carga-puxada-barra-fixa" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Excelente para fortalecer as costas e os braços. Use a máquina de assistência, um elástico ou, se já for forte o suficiente, faça com o peso do corpo.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Remada Curvada com Halteres</td><td>3-4x(10-12) - 60s</td><td><input type="text" data-exercise-id="carga-remada-curvada-halteres" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fortalece a parte média das costas e ombros. Mantenha as costas retas e puxe os halteres em direção ao seu quadril.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Puxada Alta</td><td>3-4x(10-12) - 60s</td><td><input type="text" data-exercise-id="carga-puxada-alta" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Trabalha o latíssimo do dorso, músculo essencial para a puxada na escalada.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Remada Sentada na Máquina</td><td>3-4x(10-12) - 60s</td><td><input type="text" data-exercise-id="carga-remada-sentada-maquina" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fortalece a região média e alta das costas.</td></tr>
                    <tr class="superset-group toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Rosca Direta com Barra</td><td>3-4x(10-12)</td><td><input type="text" data-exercise-id="carga-rosca-direta" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Foco no bíceps e antebraços.</td></tr>
                    <tr class="superset-group toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Prancha (Core)</td><td>3-4x(45-60s) - 60s</td><td><input type="text" data-exercise-id="carga-prancha" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fortalece o core (abdômen e lombar).</td></tr>
                </tbody>
            </table>
        </div>

        <div class="forca-peito-ombros-section content-section">
            <h2 id="forca-peito-ombros" class="collapsible-title">PEITO E OMBROS</h2>
            <table class="collapsible-content hidden">
                <thead><tr><th>Exercício</th><th>S x R - D</th><th>Carga</th></tr></thead>
                <tbody>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Supino Inclinado c/ Halteres (Pirâmide)</td><td>4x(12, 10, 8, 8) - 90s</td><td><input type="text" data-exercise-id="carga-supino-inclinado" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Foca na parte superior do peito e ombros. Deite-se em um banco inclinado e empurre os halteres para cima. Controle o movimento na descida.<br><b>Nota Pirâmide:</b> Comece com um peso para 12 repetições e aumente a carga a cada série, diminuindo as repetições.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Desenv. de Ombro c/ Halteres</td><td>3-4x(8-12) - 60s</td><td><input type="text" data-exercise-id="carga-desenv-ombro" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fortalece os ombros. Sente-se ou fique em pé e empurre os halteres para cima.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Flexão de Braço</td><td>3-4x(10-15) - 60s</td><td><input type="text" data-exercise-id="carga-flexao-braco" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Trabalha peito, ombros e tríceps.</td></tr>
                    <tr class="superset-group toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Tríceps Testa</td><td>3-4x(10-15)</td><td><input type="text" data-exercise-id="carga-triceps-testa" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Isola o músculo tríceps.</td></tr>
                    <tr class="superset-group toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Face Pull</td><td>3x(12-15) - 60s</td><td><input type="text" data-exercise-id="carga-face-pull" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fortalece a porção posterior do ombro e as escápulas.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Elevação Lateral c/ Halteres</td><td>3x(12-15) - 60s</td><td><input type="text" data-exercise-id="carga-elevacao-lateral" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fortalece a porção lateral do ombro.</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="forca-pernas-section content-section">
            <h2 id="forca-pernas" class="collapsible-title">PERNAS</h2>
            <table class="collapsible-content hidden">
                <thead><tr><th>Exercício</th><th>S x R - D</th><th>Carga</th></tr></thead>
                <tbody>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Agach. Livre c/ Barra (Pirâmide)</td><td>4x(12, 10, 8, 6) - 90-120s</td><td><input type="text" data-exercise-id="carga-agachamento-livre" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fundamental para o fortalecimento das pernas e joelhos.<br><b>Nota Pirâmide:</b> Comece com um peso para 12 repetições e aumente a carga a cada série, diminuindo as repetições.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Avanço com Halteres</td><td>3-4x(10-12 por perna) - 60s</td><td><input type="text" data-exercise-id="carga-avanco-halteres" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fortalece quadríceps, glúteos e a estabilidade dos joelhos.</td></tr>
                    <tr class="superset-group toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Cadeira Extensora</td><td>3-4x(12-15)</td><td><input type="text" data-exercise-id="carga-cadeira-extensora" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Isola o quadríceps. Ótimo exercício de baixo impacto.</td></tr>
                    <tr class="superset-group toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Mesa Flexora</td><td>3-4x(10-12) - 60s</td><td><input type="text" data-exercise-id="carga-mesa-flexora" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fortalece os isquiotibiais (parte de trás da coxa).</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Stiff com Halteres</td><td>3x(10-12) - 60s</td><td><input type="text" data-exercise-id="carga-stiff" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Foco nos isquiotibiais e glúteos.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td class="exercise-name">Panturrilha em Pé</td><td>3-4x(15-20) - 45s</td><td><input type="text" data-exercise-id="carga-panturrilha-pe" oninput="saveCarga(this.dataset.exerciseId, this.value)" class="w-full text-sm p-1 border rounded-md"></td></tr>
                    <tr class="details-row hidden"><td colspan="3">Fortalece a panturrilha.</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="mobilidade-section content-section">
            <h2 id="mobilidade" class="collapsible-title">MOBILIDADE E RECUPERAÇÃO</h2>
            <table class="collapsible-content hidden">
                <thead><tr><th>Área</th><th>Exercício</th><th>T x R</th></tr></thead>
                <tbody>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td><img src="img/spine.svg" onerror="this.style.display='none'" class="w-6 h-6 mx-auto" alt="Coluna"></td><td class="exercise-name">Mobilidade Felino-Vaca</td><td>10 x 2-3</td></tr>
                    <tr class="details-row hidden"><td colspan="3">Comece de quatro. Inspire, arqueando as costas e olhando para cima (vaca). Expire, arredondando a coluna (gato).</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td><img src="img/hips.svg" onerror="this.style.display='none'" class="w-6 h-6 mx-auto" alt="Quadril"></td><td class="exercise-name">Spiderman Lunge com Rotação</td><td>8-10 reps por lado x 2-3</td></tr>
                    <tr class="details-row hidden"><td colspan="3">Em posição de prancha, traga um pé para o lado de fora da mão. Gire o tronco, estendendo o braço do mesmo lado para o teto.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td><img src="img/hips.svg" onerror="this.style.display='none'" class="w-6 h-6 mx-auto" alt="Quadril"></td><td class="exercise-name">Rotação de Quadril 90/90</td><td>8-10 rotações x 2-3</td></tr>
                    <tr class="details-row hidden"><td colspan="3">Sente-se com os joelhos dobrados a 90 graus. Gire ambos os joelhos para um lado e depois para o outro.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td><img src="img/hips.svg" onerror="this.style.display='none'" class="w-6 h-6 mx-auto" alt="Quadril"></td><td class="exercise-name">Alongamento do Quadril em Posição de "Pombo"</td><td>60s x 2-3 por lado</td></tr>
                    <tr class="details-row hidden"><td colspan="3">Comece de quatro, traga um joelho para a frente e estenda a outra perna para trás.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td><img src="img/shoulders.svg" onerror="this.style.display='none'" class="w-6 h-6 mx-auto" alt="Ombros"></td><td class="exercise-name">Alongamento "Rosca Francesa"</td><td>30s x 2-3 por lado</td></tr>
                    <tr class="details-row hidden"><td colspan="3">Leve um braço por trás da cabeça e puxe suavemente o cotovelo com a outra mão.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td><img src="img/wrists.svg" onerror="this.style.display='none'" class="w-6 h-6 mx-auto" alt="Punhos"></td><td class="exercise-name">Rotação de Punhos e Antebraços</td><td>30s x 2-3</td></tr>
                    <tr class="details-row hidden"><td colspan="3">De quatro, com as mãos no chão, gire as mãos para que os dedos apontem para os joelhos e incline-se para trás.</td></tr>
                    <tr class="toggle-row" onclick="toggleDetails(this)"><td><img src="img/torso.svg" onerror="this.style.display='none'" class="w-6 h-6 mx-auto" alt="Torácica"></td><td class="exercise-name">Alongamento de Coluna Torácica</td><td>30s x 2-3 por lado</td></tr>
                    <tr class="details-row hidden"><td colspan="3">Deite-se de lado com os joelhos flexionados. Gire a parte superior do tronco para o lado oposto, estendendo o braço.</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadCargas();
            setupCollapsibles();
            setupFlexibleAgenda();
        });

        function saveCarga(exerciseId, value) {
            localStorage.setItem(exerciseId, value);
        }

        function loadCargas() {
            document.querySelectorAll('input[data-exercise-id]').forEach(input => {
                const savedValue = localStorage.getItem(input.dataset.exerciseId);
                if (savedValue) input.value = savedValue;
            });
        }
        
        function toggleDetails(row) {
             if (event.target.tagName === 'INPUT') return;
            let detailsRow = row.nextElementSibling;
            if (detailsRow && detailsRow.classList.contains('details-row')) {
                detailsRow.classList.toggle('hidden');
            }
        }
        
        function setupCollapsibles() {
            const collapsibleTitles = document.querySelectorAll('.collapsible-title');
            collapsibleTitles.forEach(title => {
                const content = title.nextElementSibling;
                if (content && content.tagName === 'TABLE') {
                    content.classList.add('collapsible-content', 'hidden');
                    title.addEventListener('click', () => {
                        title.classList.toggle('expanded');
                        content.classList.toggle('hidden');
                    });
                }
            });
        }
        
        function setupFlexibleAgenda() {
            const agendaContainer = document.getElementById('agenda-container');
            const activities = {
                'costas': { name: 'Costas & Bíceps', color: 'costas', iconUrl: 'img/biceps.svg', iconFallback: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 17.25h16.5M5.25 6.75v10.5m13.5-10.5v10.5" /></svg>` },
                'peito': { name: 'Peito & Ombros', color: 'peito-ombros', iconUrl: 'img/chest.svg', iconFallback: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 17.25h16.5M5.25 6.75v10.5m13.5-10.5v10.5" /></svg>` },
                'pernas': { name: 'Pernas', color: 'pernas', iconUrl: 'img/legs.svg', iconFallback: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4a2 2 0 100 4 2 2 0 000-4z" /><path stroke-linecap="round" stroke-linejoin="round" d="M7 21v-4a5 5 0 015-5h0a5 5 0 015 5v4" /><path stroke-linecap="round" stroke-linejoin="round" d="M5 21h14" /></svg>`},
                'pedal': { name: 'Pedal', color: 'cardio', iconUrl: 'img/bike.svg', iconFallback: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 7.5l-3.75 3.75M6.75 19.5l3.75-3.75" /><circle cx="8" cy="18" r="3" /><circle cx="16" cy="6" r="3" /></svg>`},
                'escalada': { name: 'Escalada', color: 'cardio', iconUrl: 'img/climb.svg', iconFallback: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /><circle cx="12" cy="4" r="2" /><path stroke-linecap="round" stroke-linejoin="round" d="M10 16l-4 4m8-4l4 4" /></svg>`},
                'mobilidade': { name: 'Descanso Ativo', color: 'mobilidade', iconUrl: 'img/mobility.svg', iconFallback: `<svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4a2 2 0 100 4 2 2 0 000-4z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9.75L12 13.5l-3.75-3.75M5.25 21v-3.75a3.75 3.75 0 013.75-3.75h6a3.75 3.75 0 013.75 3.75V21" /></svg>`},
                'descanso': { name: 'Descanso', color: 'descanso', iconUrl: 'img/rest.svg', iconFallback: `<svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 9h4l-4 6h4m4-6h4l-4 6h4" /></svg>`}
            };
            
            let weeklySchedule = JSON.parse(localStorage.getItem('weeklySchedule')) || [
                { day: 'Seg', activityId: 'descanso' }, { day: 'Ter', activityId: 'costas' },
                { day: 'Qua', activityId: 'pedal' }, { day: 'Qui', activityId: 'peito' },
                { day: 'Sex', activityId: 'pernas' }, { day: 'Sáb', activityId: 'escalada' },
                { day: 'Dom', activityId: 'pedal' }
            ];

            let activeEditorIndex = null;
            
            const validateSchedule = (schedule) => {
                const warnings = Array(7).fill(null).map(() => ({ hasWarning: false, message: '' }));
                const strengthActivities = ['costas', 'peito', 'pernas'];

                for (let i = 0; i < 7; i++) {
                    const currentDay = schedule[i];
                    const nextDay = schedule[(i + 1) % 7];
                    const prevDay = schedule[(i + 6) % 7];

                    if (strengthActivities.includes(currentDay.activityId) && currentDay.activityId === nextDay.activityId) {
                        warnings[(i + 1) % 7].hasWarning = true;
                        warnings[(i + 1) % 7].message += 'Duas sessões de força idênticas em dias consecutivos.\n';
                    }
                    
                    if (prevDay.activityId === 'costas' && currentDay.activityId === 'escalada') {
                        warnings[i].hasWarning = true;
                        warnings[i].message += 'Escalada não é recomendada após o treino de costas.\n';
                    }

                    if ((currentDay.activityId === 'pernas' && (nextDay.activityId === 'pedal' || prevDay.activityId === 'pedal')) ||
                        (currentDay.activityId === 'pedal' && (nextDay.activityId === 'pernas' || prevDay.activityId === 'pernas')) ) {
                        warnings[i].hasWarning = true;
                        warnings[i].message += 'Treino de pernas e pedal em dias consecutivos não é ideal.\n';
                    }
                }
                
                let globalWarning = '';
                const requiredActivities = {
                    'costas': 'Costas & Bíceps', 'peito': 'Peito & Ombros',
                    'pernas': 'Pernas', 'pedal': 'Pedal', 'escalada': 'Escalada'
                };
                const presentActivities = new Set(schedule.map(item => item.activityId));
                const missingActivities = [];
                for (const id in requiredActivities) {
                    if (!presentActivities.has(id)) {
                        missingActivities.push(requiredActivities[id]);
                    }
                }
                if (missingActivities.length > 0) {
                    globalWarning = `Faltam as seguintes atividades na semana: ${missingActivities.join(', ')}.`;
                }
                
                return { warnings, globalWarning };
            };

            const createIconHTML = (activity) => {
                const escapedSVG = activity.iconFallback.replace(/"/g, "'");
                return `<img src="${activity.iconUrl}" onerror="this.outerHTML = \`${escapedSVG}\`;" alt="icon">`;
            };

            const renderAgenda = () => {
                agendaContainer.innerHTML = '';
                const { warnings, globalWarning } = validateSchedule(weeklySchedule);
                const todayIndex = (new Date().getDay() + 6) % 7; 

                const warningContainer = document.getElementById('agenda-global-warning');
                if (globalWarning) {
                    warningContainer.innerHTML = `
                        <div class="warning-icon"><svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg></div>
                        <span>${globalWarning}</span>`;
                    warningContainer.className = 'global-warning';
                } else {
                    warningContainer.innerHTML = '';
                    warningContainer.className = 'hidden';
                }

                weeklySchedule.forEach((daySchedule, index) => {
                    const activity = activities[daySchedule.activityId];
                    const warning = warnings[index];
                    const itemEl = document.createElement('div');
                    let dayClasses = ['day-item'];
                    if (activeEditorIndex === index) dayClasses.push('active');
                    if (warning.hasWarning) dayClasses.push('has-warning');
                    if (index === todayIndex) dayClasses.push('is-today');
                    itemEl.className = dayClasses.join(' ');

                    const warningIconHTML = warning.hasWarning
                        ? `<div class="warning-icon" title="${warning.message.trim()}">
                               <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
                           </div>`
                        : '';

                    itemEl.innerHTML = `
                        <div class="day-display" data-index="${index}">
                            <div class="day-name">${daySchedule.day}</div>
                            <div class="activity-color-bar color-${activity.color.replace('-ombros','')}"></div>
                            <div class="activity-icon">${createIconHTML(activity)}</div>
                            <div class="activity-name">${activity.name}</div>
                            ${warningIconHTML}
                            <div class="edit-icon">
                                <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>
                            </div>
                        </div>
                        <div class="activity-options ${activeEditorIndex === index ? '' : 'hidden'}">
                            ${Object.keys(activities).map(id => {
                                const act = activities[id];
                                return `
                                <button class="option-btn option-${act.color.replace('-biceps','').replace('-ombros','')} ${daySchedule.activityId === id ? 'selected' : ''}" title="${act.name}" onclick="updateActivity(${index}, '${id}')">
                                    ${createIconHTML(act)}
                                </button>
                            `}).join('')}
                        </div>
                    `;
                    agendaContainer.appendChild(itemEl);
                });
                
                document.querySelectorAll('.day-display').forEach(el => {
                    el.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index, 10);
                        activeEditorIndex = activeEditorIndex === index ? null : index;
                        renderAgenda();
                    });
                });
            };
            
            window.updateActivity = (dayIndex, activityId) => {
                weeklySchedule[dayIndex].activityId = activityId;
                localStorage.setItem('weeklySchedule', JSON.stringify(weeklySchedule));
                activeEditorIndex = null;
                renderAgenda();
            };

            renderAgenda();
        }
    </script>
</body>

</html>
